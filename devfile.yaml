
schemaVersion: 2.1.0
metadata:
  name: demo-war
  version: 1.2.0
  description: Simple Maven webapp project
  displayName: Maven Webapp
  language: Java
  projectType: maven-webapp
  tags:
  - Java
  - Webapp


commands:
- id: mvn-package
  exec:
    commandLine: |
      ./mvnw package \
        -Dmaven.compiler.source=17 \
        -Dmaven.compiler.target=11 \
        -Dmaven.test.skip=true
    component: builder
    workingDir: ${PROJECT_SOURCE}
- id: copy-war
  exec:
    commandLine: cp target/*.war /home/user/artifacts/
    component: builder
    workingDir: ${PROJECT_SOURCE}
- id: builder
  composite:
    commands:
      - mvn-package
      - copy-war
    group:
      isDefault: true
      kind: build

- id: run
  exec:
    commandLine: /opt/jws-5.7/tomcat/bin/launch.sh
    component: app-server
    hotReloadCapable: true
    group:
      isDefault: true
      kind: run
    workingDir: ${PROJECT_SOURCE}

components:
- name: builder
  container:
    command: ["tail", "-f", "/dev/null"]
    image: registry.access.redhat.com/ubi9/openjdk-17:latest
    mountSources: true
    volumeMounts:
    - name: artifacts
      path: /home/user/artifacts

- name: app-server
  container:
    command: ["tail", "-f", "/dev/null"]
    endpoints:
    - name: http-tomcat
      targetPort: 8080
    image: registry.redhat.io/jboss-webserver-5/jws57-openjdk11-openshift-rhel8:5.7.2-7
    mountSources: false
    volumeMounts:
    - name: artifacts
      path: /opt/jws-5.7/tomcat/webapps

- name: artifacts
  volume: {}

